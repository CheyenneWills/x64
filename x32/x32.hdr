	%include	"x32/x32.s"
		extern	atlin

	segment	.data

%define		XL	esi
%define		XR	edi
%define		XS	esp
%define		XT	esp
%define		WA	ecx
%define		WB	ebx
%define		WC	edx
%define		IA	edx
%define		CP	ebp
%define		W0	eax

	extern	reg_ra

direct equ 0

; define how floating point results are returned from a function
; (either in st(0) or in edx:eax.
fretst0 equ 1
freteax equ 0

	segment		.data
	global	nlines
nlines	dd	0
	segment		.text
; following generated by def.spt in ../test directory
	global	B_EFC
%define	b_efc	B_EFC
	global	B_ICL
%define	b_icl	B_ICL
	global	B_RCL
%define	b_rcl	B_RCL
	global	B_SCL
%define	b_scl	B_SCL
	global	B_VCT
%define	b_vct	B_VCT
	global	B_XNT
%define	b_xnt	B_XNT
	global	B_XRT
%define	b_xrt	B_XRT
	global	C_AAA
%define	c_aaa	C_AAA
	global	CSWFL
%define	cswfl	CSWFL
	global	C_YYY
%define	c_yyy	C_YYY
	global	DFFNC
%define	dffnc	DFFNC
	global	DNAMB
%define	dnamb	DNAMB
	global	DNAMP
%define	dnamp	DNAMP
	global	FLPRT
%define	flprt	FLPRT
	global	FLPTR
%define	flptr	FLPTR
	global	G_AAA
%define	g_aaa	G_AAA
	global	GBCNT
%define	gbcnt	GBCNT
	global	GTCEF
%define	gtcef	GTCEF
	global	HEADV
%define	headv	HEADV
	global	HSHTB
%define	hshtb	HSHTB
	global	ID1
%define	id1	ID1
	global	ID2BLK
%define	id2blk	ID2BLK
	global	INPBUF
%define	inpbuf	INPBUF
	global	KVCOM
%define	kvcom	KVCOM
	global	KVDMP
%define	kvdmp	KVDMP
	global	KVFTR
%define	kvftr	KVFTR
	global	KVPFL
%define	kvpfl	KVPFL
	global	KVSTN
%define	kvstn	KVSTN
	global	LOWSPMIN
%define	lowspmin	LOWSPMIN
	global	MXLEN
%define	mxlen	MXLEN
	global	PMHBS
%define	pmhbs	PMHBS
	global	POLCT
%define	polct	POLCT
	global	R_COD
%define	r_cod	R_COD
	global	R_FCB
%define	r_fcb	R_FCB
	global	S_AAA
%define	s_aaa	S_AAA
	global	STAGE
%define	stage	STAGE
	global	STATB
%define	statb	STATB
	global	STATE
%define	state	STATE
	global	STBAS
%define	stbas	STBAS
	global	STMCS
%define	stmcs	STMCS
	global	STMCT
%define	stmct	STMCT
	global	S_YYY
%define	s_yyy	S_YYY
	global	TICBLK
%define	ticblk	TICBLK
	global	TIMSX
%define	timsx	TIMSX
	global	TSCBLK
%define	tscblk	TSCBLK
	global	TTYBUF
%define	ttybuf	TTYBUF
	global	TYPET
%define	typet	TYPET
	global	W_YYY
%define	w_yyy	W_YYY


;
;   table to recover type word from type ordinal
;

TYPET:
        dd      b_art   ; arblk type word - 0
        dd      b_cdc   ; cdblk type word - 1
        dd      b_exl   ; exblk type word - 2
        dd 	b_icl   ; icblk type word - 3
        dd      b_nml   ; nmblk type word - 4
        dd      p_aba   ; p0blk type word - 5
        dd      p_alt   ; p1blk type word - 6
        dd      p_any   ; p2blk type word - 7
        dd 	b_rcl   ; rcblk type word - 8
        dd 	b_scl   ; scblk type word - 9
        dd      b_sel   ; seblk type word - 10
        dd      b_tbt   ; tbblk type word - 11
        dd 	b_vct   ; vcblk type word - 12
        dd 	b_xnt   ; xnblk type word - 13
        dd 	b_xrt   ; xrblk type word - 14
        dd      b_bct   ; bcblk type word - 15
        dd      b_pdt   ; pdblk type word - 16
        dd      b_trt   ; trblk type word - 17
        dd      b_bft   ; bfblk type word   18
        dd      b_cct   ; ccblk type word - 19
        dd      b_cmt   ; cmblk type word - 20
        dd      b_ctt   ; ctblk type word - 21
        dd      b_dfc   ; dfblk type word - 22
        dd 	b_efc   ; efblk type word - 23
        dd      b_evt   ; evblk type word - 24
        dd      b_ffc   ; ffblk type word - 25
        dd      b_kvt   ; kvblk type word - 26
        dd      b_pfc   ; pfblk type word - 27
        dd      b_tet   ; teblk type word - 28

;
;   table of minimal variables that can be accessed from c
;   and assembly-language via macros getoff, getptr, getmin, and setmin.
;
;   there are two ways of setting this up.  if the symbol "direct" is
;   non-zero, the symbols are declared public and accessed directly.
;   if direct is zero, access is via the function minadr in inter.asm.
;
;   the macros getoff, getptr, getmin, and setmin in os.h and os.inc
;   must be adjusted when direct is changed.
;
;   note that the order of entries in this table must correspond to the
;   order of entries in the val enumeration in os.h and os.inc.
;

;   hdrcode.inc
;
;  no header code in 386 version.
;

;   hdrdata.inc
;
;
;   table to recover type word from type ordinal
;

        dd      b_art   ; arblk type word - 0
        dd      b_cdc   ; cdblk type word - 1
        dd      b_exl   ; exblk type word - 2
        dd 	b_icl   ; icblk type word - 3
        dd      b_nml   ; nmblk type word - 4
        dd      p_aba   ; p0blk type word - 5
        dd      p_alt   ; p1blk type word - 6
        dd      p_any   ; p2blk type word - 7
        dd 	b_rcl   ; rcblk type word - 8
        dd 	b_scl   ; scblk type word - 9
        dd      b_sel   ; seblk type word - 10
        dd      b_tbt   ; tbblk type word - 11
        dd 	b_vct   ; vcblk type word - 12
        dd 	b_xnt   ; xnblk type word - 13
        dd 	b_xrt   ; xrblk type word - 14
        dd      b_bct   ; bcblk type word - 15
        dd      b_pdt   ; pdblk type word - 16
        dd      b_trt   ; trblk type word - 17
        dd      b_bft   ; bfblk type word   18
        dd      b_cct   ; ccblk type word - 19
        dd      b_cmt   ; cmblk type word - 20
        dd      b_ctt   ; ctblk type word - 21
        dd      b_dfc   ; dfblk type word - 22
        dd 	b_efc   ; efblk type word - 23
        dd      b_evt   ; evblk type word - 24
        dd      b_ffc   ; ffblk type word - 25
        dd      b_kvt   ; kvblk type word - 26
        dd      b_pfc   ; pfblk type word - 27
        dd      b_tet   ; teblk type word - 28
;
;   table of minimal entry points that can be accessed from c
;   via the minimal function (see inter.asm).
;
;   note that the order of entries in this table must correspond
;   to the order of entries in the call enumeration in os.h
;   and os.inc.
;
        global  calltab
calltab:
        dd      relaj
        dd      relcr
        dd      reloc
        dd      alloc
        dd      alocs
        dd      alost
        dd      blkln
        dd      insta
        dd      rstrt
        dd      start
        dd      filnm
        dd      dtype
;       dd      enevs ;  engine words
;       dd      engts ;   not used

;
;   table of minimal variables that can be accessed from c
;   and assembly-language via macros getoff, getptr, getmin, and setmin.
;
;   there are two ways of setting this up.  if the symbol "direct" is
;   non-zero, the symbols are declared public and accessed directly.
;   if direct is zero, access is via the function minadr in inter.asm.
;
;   the macros getoff, getptr, getmin, and setmin in os.h and os.inc
;   must be adjusted when direct is changed.
;
;   note that the order of entries in this table must correspond to the
;   order of entries in the val enumeration in os.h and os.inc.
;
        global  valtab
valtab:
	dd	gbcnt
	dd	headv
	dd	mxlen
	dd	stage
	dd	timsx
	dd	dnamb
	dd	dnamp
	dd	state
	dd	b_efc
	dd	b_icl
	dd	b_scl
	dd	b_vct
	dd	b_xnt
	dd	b_xrt
	dd	stbas
	dd	statb
	dd	polct
;%if 	direct = 0
	dd  	typet
;%endif
	dd	lowspmin
	dd	flprt
	dd	flptr
	dd	gtcef
	dd	hshtb
	dd	pmhbs
	dd	r_fcb
	dd	c_aaa
	dd	c_yyy
	dd	g_aaa
	dd	w_yyy
	dd	s_aaa
	dd	s_yyy
	dd	r_cod
	dd	kvstn
	dd	kvdmp
	dd	kvftr
	dd	kvcom
	dd	kvpfl
	dd	cswfl
        dd  stmcs
        dd  stmct
	dd	b_rcl
	dd	end_min_data

